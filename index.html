<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        const ws = new WebSocket("ws://xu@vm-sdc-09.icube.unistra.fr:8081");

        const userId = JSON.stringify({
            header:"REQUEST_CLIENT_ID"
        });
        var getImg;
        var uid;
        var result;
        var parsed;
        ws.addEventListener("open", () => {
            ws.send(userId);
        });
        ws.addEventListener('message',function(event){
            parsed = JSON.parse(event.data);
            if (parsed.clientId === undefined){
                if (parsed.idData === undefined){
                    result = parsed.base64File;
                }
                else {
                    getImg = JSON.stringify({
                        idMessage: parsed.clientId,
                        doRescale: false,
                        clientId: uid,
                        header: "GET_BUFFER_IMAGE"
                    });
                }
            }
            else{
                uid = String(parsed.clientId);
                getImg = JSON.stringify({
                    checksum: "0333ff8c224366dac05ba154f2c6e4d9",
                    isLaunchOrthoRect: false,
                    fileName: "070992.tif",
                    overWrite: false,
                    clientId: uid,
                    header: "OPEN_IMAGE"
                });
            }
            if (parsed.base64File === undefined){
                ws.send(getImg);
            }
        });
            
    </script>
</body>
</html>